google:

  is a thing:
    - req:
        route: "http://google.com"
      rep:
        code: 200

the api:

  has status:
    - req:
        route: /
      rep:
        code: 200

  should fetch a value after putting it, but not before:
    - info: fetching an unknown id 404s
      req:
        route: /fetch/123
      rep:
        code: 404

    - info: putting a value returns an id
      req:
        route: /put
        verb: post
        body: asdf
      rep:
        body: {$set: id}

    - info: fetching that id returns the value
      req:
        route: /fetch/$id
      rep:
        body: asdf

    - info: fetching that id and store the return value in a var
      req:
        route: /fetch/$id
      rep:
        body: {$set: body}

    - info: fetching that id again, returns an identical value
      req:
        route: /fetch/$id
      rep:
        body: {$get: body}

  can get an object back instead of a value on put:
    - info: putting a value returns an id in a dict
      req:
        route: /put?return_dict=true
        verb: post
        body: foo
      rep:
        body: {$set: id}

    - info: fetching that id with $obj.key returns the value
      req:
        route: /fetch/$id.uuid
      rep:
        body: foo

    - info: dotted access works for req body
      req:
        route: /put
        verb: post
        body: {$get: id.uuid}
      rep:
        body: {$set: new_id}

    - info: dotted access works for rep body
      req:
        route: /fetch/$new_id
      rep:
        body: {$get: id.uuid}

  should read a value after writing, but not before:
    - req:
        route: /get/foo
      rep:
        code: 404

    - req:
        route: /set/foo
        verb: post
        body: bar
      rep:
        code: 200

    - req:
        route: /get/foo
      rep:
        body: bar

  should 404 on missing route:
    - req:
        route: /missing
      rep:
        code: 404
